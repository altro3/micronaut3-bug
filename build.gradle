plugins {
    id 'java'
    id "org.springframework.boot" version "3.4.4"
//    id 'io.micronaut.application' version '4.5.0'
//    id 'io.micronaut.aot' version '4.5.0'
//    id 'io.micronaut.openapi' version '4.5.0'
//    id 'org.openapi.generator' version '7.12.0'
}

ext {

    ver = [
            springBoot: '3.4.4',
            micronaut : '4.8.2',
            core      : '4.8.11',
            openapi   : '6.15.0',
            serde     : '2.14.0'
    ]

    jreImage = 'bellsoft/liberica-openjre-alpine:17.0.10'
    jreImageNative = 'debian:stable-slim'
}

wrapper.gradleVersion = '8.13'

java {
    sourceCompatibility = JavaVersion.VERSION_17
}

dependencies {

    annotationProcessor(
            platform("org.springframework.boot:spring-boot-dependencies:$ver.springBoot"),
            "org.springframework.boot:spring-boot-configuration-processor",
            "org.projectlombok:lombok",
    )

    compileOnly(
            "org.projectlombok:lombok",
            "com.fasterxml.jackson.core:jackson-annotations",
    )

    implementation(
            platform("org.springframework.boot:spring-boot-dependencies:$ver.springBoot"),
            "org.springframework.boot:spring-boot-starter-web",
            "org.springframework.boot:spring-boot-starter-logging",
            "org.springframework.boot:spring-boot-starter-json",
            "org.springframework.boot:spring-boot-starter-validation",
            "org.springframework.boot:spring-boot-starter-actuator",
            "ch.qos.logback:logback-classic",
    )
}

//project.gradle.startParameter.excludedTaskNames.add("generateServerOpenApiModels")
//tasks.named("generateServerOpenApiApis") {
//    it.enabled = false
//}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
    options.compilerArgs = [
            '-parameters',
            '-Xlint:unchecked',
            '-Xlint:deprecation'
    ]
    options.fork = true
//    options.forkOptions.jvmArgs += "-Dmicronaut.openapi.views.spec=swagger-ui.enabled=true,swagger-ui.js.url=/openapi/res/"
}

configurations.configureEach {
    resolutionStrategy {
        cacheDynamicVersionsFor 0, 'minutes'
        cacheChangingModulesFor 0, 'minutes'
    }
}
